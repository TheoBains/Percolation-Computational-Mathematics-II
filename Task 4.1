# ---- PARAMETERS ----
M = 1000       # number of realisations
L = 200        # lattice size
p = 0.58      # occupation probability

allarea = []

for _ in range(M):
    # generate configuration
    z = np.random.rand(L, L)
    m = z < p
    lw, num = label(m)
    labelList = np.arange(lw.max() + 1)
    # compute cluster areas 
    areas = sum(m, lw, labelList)
    allarea = np.append(allarea, areas)

# ---- LINEAR BINS ----
# Bins
n, sbins = np.histogram(allarea, bins=int(max(allarea)))
s = 0.5*(sbins[1:] + sbins[:-1])
# Cluster number density n(s,p;L) = n/ML^2
nsp = n / (M * L**2)
# Nonzero indices for plot clarity
i = np.nonzero(n)

# ---- LOG BINS ----
a = 1.2     #log binning parameter 
logamax = np.ceil(np.log(max(s))/np.log(a))
logbins = a ** np.arange(0, logamax)
nl, nlbins = np.histogram(allarea, bins=logbins)
ds = np.diff(logbins) # difference between bins 
sl = 0.5 * (logbins[1:] + logbins[:-1])        # bin centers
nsl = nl / (M * L**2 * ds)  

# Remove any empty bins 
mask = nsl > 0
sl= sl[mask]
nsl= nsl[mask]


# ---- PLOTS ----

plt.figure(figsize=(12,4))
# left fig
plt.subplot(1,2,1)
plt.plot(s[i],nsp[i],'o')
plt.xlabel('$s$', fontsize = 13)
plt.ylabel('$n(s,p)$', fontsize = 13)
#match axis limits in book
ax = plt.gca()
ax.set_xlim([0, 1500])
ax.set_ylim([0, 0.00010])
# make tick labels larger
plt.xticks(fontsize=10)
plt.yticks(fontsize=10)

#right fig
plt.subplot(1,2,2)
plt.loglog(s[i],nsp[i],'o')
plt.xlabel('$s$', fontsize = 13)
plt.ylabel('$n(s,p)$', fontsize = 13)
# make tick labels larger
plt.xticks(fontsize=10)
plt.yticks(fontsize=10)
# red line
plt.loglog(sl,nsl,'.r')

plt.show()
